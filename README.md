# Домашнее задание к занятию "`Репликация и масштабирование. Часть 2`" - `Шереметьев Аким Русланович`

### Задание 1

1. Устройство активного master-сервера и пассивного репликационного slave-сервера выражено в том, что мастер выполняет все операции: как запись, так и чтение. Репликационный слейв-сервер просто находится в резерве, то есть синхронизируется с мастером, копирует вносимые данные, но не занимается обслуживанием запросов на то же самое чтение. 

Из самых очевидных преимуществ можно выделить отказоустойчивость, так как в случае с выходом из строя мастера, слейв-сервер может сразу же включиться в работу без потери данных благодаря резервному копированию. Данный метод относительно прост в реализации, потому что не требует разрешения конфликтов между данными, так как слейв пассивен. В случае с повышенной нагрузкой на мастер, можно всегда переключить в слейва в активный режим, чтобы он занялся обработкой запросов на чтение, контролируя наплыв запросов на систему.


2. В случае с master-сервером и несколько slave-серверами несколько по-другому: мастер обрабатывает все запросы на изменение данных (запись, удаление, обновление), а слейв-сервера обслуживают запросы на чтение данных и их резервное копирование. 

Данный метод будет нам полезен, если мы хотим, например, оптимизировать нагрузку: если несколько слейвов будут заниматься чтением данные, то это существенно снизит нагрузку на мастер-сервер, а так как мы имеем несколько слейвов, то скорость чтения тоже должна повыситься и данные будут доступны большему количеству пользователей. Несколько слейв-серверов также способствуют отказоустойчивости: если один слейв выходит из строя, другие продолжают работу. Помимо обслуживания запросов на чтение, слейв-сервера можно использовать для аналитики данных или тестирования, не нагружая мастер. 

### Задание 2

#### План для выполнения горизонтального и вертикального шаринга базы данных

Горизонтальное шардирование подразумевает разделение таблицы на несколько меньших таблиц, где каждая таблица имеет такое же количество столбцов, но меньшее количество строк. Разделение таким образом, например, может происходить по диапазону ключей или логике разделения. 

Как вариант, таблицу с пользователями можно разбить по диапазонам ID пользователей. Таблицу с названиями книг можно разбивать по жанрам. Таблицу с магазинами можно разбивать по регионам.

Вертикальное шардирование разделяет таблицу по столбцам, где каждая таблица содержит одинаковое количество строк, но меньшее количество столбцов. В нашем случае мы можем разделить таблицы по приоритетности данных. Например, один сервер содержит критичные для транзакций таблицу с пользователями, а другой менее критичные таблицы с книгами и магазинами.

По итогу имеем разграничение в следующем виде: таблица пользователей будет разделяться только горизонтально по диапазонам ID, таблица с книгами 

Таблица             Вертикальное шардирование         Горизонтальное шардирование
пользователи        Один сервер — все пользователи    Разделение по диапазонам ID или региона
книги               Объединение с другим сервером     Разделение по категориям или диапазонам ISBN
магазины            Объединение с другим сервером     Разделение по регионам или по регионам + времени

5. Блоксхема расположения
plaintext

+------------------------------------+    +-----------------------------------+
|       Сервер 1 (Мастер)            |    |      Сервер 2 (Шард 2)            |
|  ┌───────────────┐                 |    |   ┌───────────────┐               |
|  │ Пользователи  │                 |    |   │ Пользователи  │               |
|  └───────────────┘                 |    |   └───────────────┘               |
|                                    |    |                                   |
+------------------------------------+    +-----------------------------------+

+------------------------------------+    +-----------------------------------+
|       Сервер 3 (Мастер)            |    |     Сервер 4 (Шард 4)             |
|  ┌───────────────┐                 |    |   ┌───────────────┐               |
|  │ Книги         │                 |    |   │ Каталоги      │               |
|  └───────────────┘                 |    |   └───────────────┘               |
|                                    |    |                                   |
+------------------------------------+    +-----------------------------------+

+----------------------------------------------+
|   Серверы магазинов в регионах ...           |
|   (Разделение по регионам)                   |
+----------------------------------------------+

5. Режимы работы серверов
Мастер-сервера (Primary): Обрабатывает все операции записи, обновления баз данных; принимает запросы вставки/обновления.
Шард-сервера (Replica): Отвечает за чтение; может находиться в режиме репликации с основным сервером для масштабирования чтения.
Балансировщик запросов: маршрутизирует запросы читателей к шард-серверам, а запросы писателей — к мастер-серверам.
Режимы работы:
Мастер: активный режим, обеспечивает консистентность данных.
Шард-серверы: могут работать в режиме read-only или read-write, в зависимости от стратегии масштабирования.
В случае горизонтального шардирования — каждый шард работает независимо, обменясь данными через синхронизацию или репликацию.


Итог
Вертикальное шардирование делит таблицы по функциональности (критичные vs вспомогательные).
Горизонтальное шардирование делит таблицы внутри по ключам (ID, регион, категория).
В системе используют мастера для записи и шарды для чтения, что повышает масштабируемость и отказоустойчивость.

